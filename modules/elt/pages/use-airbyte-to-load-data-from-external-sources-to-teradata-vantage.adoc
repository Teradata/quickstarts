= Use Airbyte to load data from external sources to Teradata Vantage
:experimental:
:page-author: Krutik Pathak
:page-email: krutik.pathak@teradata.com
:page-revdate: June 6th, 2023
:description: Use Airbyte with Teradata Vantage.
:keywords: airbyte, data warehouses, compute storage separation, teradata, vantage, cloud data platform, object storage, data transfer, data extraction, enterprise analytics, elt.
:tabs:
:dir: getting-started-with-airbyte

== Overview

This tutorial showcases how to use Airbyte (an Open Source Extract Load Transform tool) with Teradata Vantage. We work with a very simple end-to-end setup to load the employees’ data from Google Sheets to Teradata Vantage using Airbyte.


image::{dir}/sample_employees_payrate_google_sheets.png[Sample Employees Payrate Google Sheets, width=75%]

* Source: Google Sheets
* Destination: Teradata Vantage

== Prerequsites
* Access to Teradata Vantage Instance, as this will be the destination. You will need a database `Host`, `Username`, and `Password` for Airbyte’s configuration.
+
include::ROOT:partial$vantage_clearscape_analytics.adoc[]

* Docker Compose to run the link:https://github.com/airbytehq/airbyte[Airbyte Open Source] locally. Docker Compose comes with Docker Desktop. Please refer to link:https://docs.docker.com/compose/install/[docker docs] for more details. 

* Data from the source system. Here, in this case, we take a link:https://docs.google.com/spreadsheets/d/1XNBYUw3p7xG6ptfwjChqZ-dNXbTuVwPi7ToQfYKgJIE/edit#gid=0[sample employee pay rate from google sheets].

* link:https://support.google.com/googleapi/answer/6158841?hl=en[Google Cloud Platform API enabled for your personal or organizational account]. You’ll need to authenticate your Google account via OAuth or via Service Account Key Authenticator.


== Launch Airbyte Open Source
* Clone the Airbyte Open Source repository and go to the airbyte directory.
+
[source, bash]
----
git clone --depth 1 https://github.com/airbytehq/airbyte.git
cd airbyte
----

Make Sure to have Docker Desktop running before running the shell script `run-ab-platform`.

* Run the shell script `run-ab-platform` as

+
[source, bash]
----
./run-ab-platform.sh
----

+
[NOTE]
====
You can run the above commands with `git bash` in Windows. Please refer to the link:https://docs.airbyte.com/deploying-airbyte/local-deployment/[Airbyte Local Deployment] for more details. 
====

* Log in to the web app http://localhost:8000/ by entering the default credentials found in the `.env` file included in the repository.

+
[source, bash]
----
BASIC_AUTH_USERNAME=airbyte
BASIC_AUTH_PASSWORD=password
----


If you login for the first time, it will ask you for your email and specify your preferences for product improvements. Add your preferences and click `Get started`.

image::{dir}/specify_preferences.png[Specify Preferences, width=75%]

Once the Airbyte Open Source is launched you will see a connections dashboard. If you launched Airbyte Open Source for the first time, it would not show any connections.

== Airbyte Configuration

=== Setting the Source Connection
* Select `Create your first connection` or click on the top right corner for new connection in the Connections dashboard in Airbyte.

image::{dir}/create_first_connection.png[Dashboard to create first connection, width=75%]

* It will ask you for the Source, you can select from an existing source (if you have set it up already) or you can set up a new source, here we use `Google Sheets`.

* Here we are using `Service Account Key Authentication` which uses a service account key in JSON format. Toggle from the default `OAuth` to `Service Account Key Authentication`. To authenticate your Google account via Service Account Key Authentication, enter your link:https://cloud.google.com/iam/docs/keys-create-delete#creating_service_account_keys[Google Cloud service account key] in JSON format. Make sure the Service Account has the Project Viewer permission. If your spreadsheet is viewable by anyone with its link, no further action is needed. If not, link:https://www.youtube.com/watch?v=GyomEw5a2NQ[give your Service account access to your spreadsheet.]

* The link to the spreadsheet to pull the data from is to be added in `Spreadsheet Link`.


image::{dir}/configuring_source_gsheet_airbyte.png[Configuring the source in Airbyte]

[NOTE]
====
For more details, please refer link:https://docs.airbyte.com/integrations/sources/google-sheets/#:~:text=For%20Airbyte%20Open%20Source%3A[Setting Google Sheets as Source Connector in Airbyte Open Source] 
====

* Click Set up source, if configuration is correct, you will get the message `All connection tests passed!`


=== Setting the Destination Connection
* Assuming you want to create a fresh new connection with `Teradata Vantage`, Select `Teradata Vantage` as destination type under Set up the destination section.
* Add the `Host`, `User`, and `Password`. This is the same as `Host`, `Username`, and `Password` respectively that are used to create the Teradata Vantage instance in the Clearscape Analytics Environment.
* Default schema name is optional, it provides a default name, however, you can provide a name that makes more sense. Here we have provided `gsheet_airbyte_td`.

image::{dir}/configuring_destination_teradata_airbyte.png[Configuring the destination Teradata in Airbyte]


* Click Set up destination, if the configuration is correct, you will get the message `All connection tests passed!`


[NOTE]
====
You might get a configuration check failed error. Make sure your Teradata Vantage instance is running properly before making a connection through Airbyte. 
====

=== Configuring Data Sync
Namespace is a group of streams(tables) in a source or destination. A schema in a relational database system is an example of a namespace. In a source, the namespace is the location from where the data is replicated to the destination. In a destination, the namespace is the location where the replicated data is stored in the destination.
For more details please refer link:https://docs.airbyte.com/understanding-airbyte/namespaces/[Airbyte Namespace]


image::{dir}/namespaces_in_destination.png[Namespaces in the destination]


In this use case the destination is a database, so the namespace is the default schema `gsheet_airbyte_td` we defined when we configured the destination, and the stream name is a table that is mirroring the name of the spreadsheet in the source, which is `sample_employee_payrate` in this case. Other type of sources and destinations might have a different layout, in this example, Google sheets as source does not support a namespace, and since it is the single spreadsheet connector, it only supports one stream (the active spreadsheet).
Here in this use case, we have used Namespace for the destination as `<destination_schema>` which is a destination default namespace. So, we will be getting `gsheet_airbyte_td` database in our Vantage Instance.


==== Replication Frequency
It shows how often data should sync to destination. You can select every hour, 2 hours, 3 hours etc. In our case we used every 24 hours. 

image::{dir}/replication_frequency_24hr.png[Replication Frequency 24 hours]

You can also use a Cron expression to specify the time when the sync should run. Here in this case, we set the Cron expression to run the sync on every Wednesday at 12:43 PM (US/Pacific) time.

image::{dir}/replication_frequency_cron_expression.png[Replication Frequency Cron Expression]

=== Data Sync Validation

Once the data sync is completed, you will be able to see the successful sync in Sync History in the Airbyte. 

image::{dir}/data_sync_summary.png[Data Sync Summary]

Next, you can go to the link:https://clearscape.teradata.com/dashboard[ClearScape Analytics Experience] and run a Jupyter notebook for Teradata SQL, to see if the database `gsheet_airbyte_td`, streams (tables) and complete data is present.

image::{dir}/data_sync_validation_in_teradata.png[Data Sync Validation in Teradata]

[source, bash]
----
%connect local 
----

[source, bash]
----
SELECT  DatabaseName, TableName, CreateTimeStamp, LastAlterTimeStamp
FROM    DBC.TablesV
WHERE   DatabaseName = 'gsheet_airbyte_td'
ORDER BY    TableName;
----

[source, bash]
----
DATABASE gsheet_airbyte_td; 
----

[source, bash]
----
SELECT * FROM _airbyte_raw_sample_employee_payrate;  
----

The stream (table) name in destination is prefixed with `\_airbyte_raw_` because Normalization and Transformation are not supported for this connection, and link:https://docs.airbyte.com/understanding-airbyte/namespaces/#:~:text=If%20you%20don%27t%20enable%20basic%20normalization%2C%20you%20will%20only%20receive%20the%20raw%20tables.[we only have the raw table]. Each stream (table) contains 3 columns: 

1. `_airbyte_ab_id`: a uuid assigned by Airbyte to each event that is processed. The column type in Teradata is VARCHAR(256).

2. `_airbyte_emitted_at`: a uuid assigned by Airbyte to each event that is processed. The column type in Teradata is VARCHAR(256)

3. `_airbyte_data`: a json blob representing with the event data. The column type in Teradata is JSON.

Here in the `_airbyte_data` column, we see 9 rows, the same as we have in the source Google sheet, and the data is in JSON format which can be transformed further as per the requirement.

=== Close and delete the connection

* You can close the connection in Airbyte by disabling the connection. This will stop the data sync process.

image::{dir}/close_airbyte_connection.png[Close Airbyte Connection]

* You can also delete the connection.

image::{dir}/delete_airbyte_connection.png[Delete Airbyte Connection]


=== Summary
This tutorial demonstrated how to get the data from a source system like Google sheets and use the Airbyte ELT tool to load the data into the Teradata Vantage Instance. We saw the end-to-end data flow and complete configuration steps that includes running the Airbyte Open Source locally, configuring the source and destination connections. We also discussed about the data sync configurations based on replication frequency. We validated the results in the destination Vantage instance using Cloudscape Analytics Experience and finally we saw the methods to pause and delete the connection in Airbyte. 

=== Further reading
link:https://docs.airbyte.com/integrations/destinations/teradata/?_ga=2.156631291.1502936448.1684794236-1752661382.1684794236[Teradata Destination | Airbyte Documentation]

link:https://docs.airbyte.com/cloud/core-concepts/#connection-sync-modes[Core Concepts | Airbyte Documentation]

link:https://airbyte.com/community[Airbyte Community Slack]

link:https://discuss.airbyte.io/[Airbyte Community]

